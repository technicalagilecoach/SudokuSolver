# Notes

## To Do
- clean up/refactor
  - XWing strategy
  - SolverWrapper (also find a new name for this)
  
  - improve -1 index calculations for accessing candidates
- make project ready to publish
    - find a name for the project
    - decide on a license before publishing on GitHub
    - polish the code to make the GitHub-repo public
    - remove data from git retrospectively, e.g. puzzle files, this notes, ...

## Done
- helper functions in SinglePuzzleTests.cs -> removed
- reduce number of test puzzle - check that there is at least one test for every strategy
  - seems like NakedTriplets/HiddenTriplets as well as NakedQuadruplets/HiddenQuadruplets are not used in my test sets
  - included selected puzzles from 0096_sudoku.txt directly in SinglePuzzleTests
  - removed puzzles from other sources as well as the corresponding tests
- improved statistics output to identify puzzles which require specific strategies more easily
- removed unused code in IndicesAndIterators.cs
  - was no longer needed because of Combinations method and generic NakedTuples and HiddenTuples strategies
- added assertions in IndicesAndPositionsTests.cs
- sorted notes and unified naming, e.g. eliminate==remove, find==identify
- currently all implemented strategies "seem" to work correctly (puzzles can be solved and self checks pass)
- improved pdf output
    - include name of puzzle
    - provide hyperlink to open puzzle in solver from https://www.sudokuwiki.org
    - refactoring of code in PdfWriter
- Create pdf for a single unsolved puzzle via CLI.
- Possibility to create a pdf for a single unsolved puzzle -> not exposed at the CLI yet.
- HiddenQuadruplets strategy is no longer problematic with Grid 7 puzzle
  - due to changes/corrections related to rows/column/box indices and values now all starting with 1 
- Change use of indices, etc. AllRows, AllColumns, AllBoxes and AllDigits now all start at 1 instead of 0.
  - This should simplify debugging, in particular now the values in the cells correspond to the actual values.
- Unified use of GetValue/SetValue
- Unify removal of candidates with RemoveCandidate(s) methods
- Always implement counting removed candidates and newly fixed cells using a member variable
- Stop solver when consistency checks fail! 
  - In order to that for candidates PruneCandidates is no longer handled the same as the other strategies.
  - As its purpose is to update the candidates after the other strategies.
  - It is now called after each strategy in the Execute function. 
- The basic strategies from https://www.sudokuwiki.org/Sudoku.htm are covered as well as the X-Wing strategy.
- Cleaned up self check for candidates == all free variables in an area must be available as candidate!
- Implemented X-Wing strategy - now also Grid 7 from 0096_sudoku.txt is solvable (all puzzles from this set are now solvable)
  - there is a conflict with HiddenQuadruplets though - for now HiddenQuadruplets is deactivated
- prototypes to narrow down what is going wrong when trying to solve Grid7 puzzle
  - try to store the last consistent state of the puzzle during solver run
  - exit solver loop with exception as soon as inconsistent state is reached
  - first version of consistency check for candidates
  - first version of pdf output for unsolved puzzles (with/without candidates)
- cleaned up BoxLineReduction
- revised pointing pairs to pointing tuples 
    - PointingPairs strategy already covers triplets -> rename it to PointingTuples
    - refactoring for cleanup
- removed deprecated code for naked and hidden pairs
- extend BoxLineReduction to triplets -> code not based on pairs or triplets
- implement remaining basic strategies (identify relevant puzzles for each)
  - implemented generic solver strategy for naked tuple (used for pairs, triplets and quadruplets)
  - implemented generic solver strategy for hidden tuples (used for pairs, triplets and quadruplets)
  - replaced NakedPairs by generic NakedTuples version
  - replaced previous GenerateNTuple by generic Combinations implementations
- implemented messy but generic code for handling naked tuples 
  - works for pairs, triplets and most likely also for quadruplets (no test case for quadruplets yet) 
- improved Hidden Pairs strategy such that it performs as expected with on example puzzle.
- implement statistics to find out which strategies are actually needed for solving a specific puzzle
- clean up code for calling the solver in SolverWrapper.cs
- clean up code in Writer.cs
- clean up code for reading in sets of puzzles in Input.cs
- move Writer.SolvePuzzles somewhere else -> SolverWrapper
- clean up code in InputCommands
- tidy up PuzzlesFromFilesTests? -> remove (file base tests are a mess, could be tested with CLI instead)
- command line switch to save only the unsolved puzzles
- preserve the puzzle names from input files of type MultiplePuzzlesWithName when storing the results
- use the same symbol for unsolved cells as in the input files when writing the results
  - currently done by replacing the characters afterward -> inefficient
  - Puzzle.Init -> no need to change, internally 0 is used to denote undefined cells
  - Puzzle.PrintCells -> additional parameter undefinedSymbol
- highlight the original fixed cells in red for SinglePuzzle mode with console output
- store output files in the same format as the input files
- distinguish different input file types
- make solver usable for end users - command line tool
- move code to read puzzles/write solutions away from Tests project
- move puzzles, notes, ... to toplevel folder outside the projects
- error handling for command line version (output file already exists, directory not writeable, ...)
- BUG precalculating indices does not work in GetIndicesForDistinctPairs, see GetIndicesForDistinctPairsTest
- change strategies such that they count the number of newly fixed values/removed candidates
- implemented the box-line-reduction strategy
- calculate indices only once -> as expected this has a big impact on performance as proven with profiling
- improved check for modification in NakedSingles by counting how many values are set
- extract common base class for different strategies
- unify indices (digits from 1 to 9, row/column/box indices 0 to 8)
- move PotentialValues to a separate class
  - PotentialValues have been renamed to candidates
  - grid should only hold the actual values
    - Cell class was removed
    - cells and candidates are now different members of the Puzzle class 
- handling pairs for boxes
- pointing pairs strategy implemented

## Version 2.0
- increase capability of solver with more advanced strategies
- one promising additional solver strategy is chute remote pairs
- improve statistics, error checking and debug support
  - should be helpful -> locate the problematic code as precisely as possible
  - detect when puzzle can not be solved -> none of the strategies helps
  - detect errors -> puzzle got into an inconsistent state
  - statistics can be activated on demand (impact on solver performance)
  - detailed diagnostics can be activated on demand (impact on solver performance)
  - clean up code for printing solutions in DebugOutput -> currently not used

## Ideas and Thoughts 
- row, columns and boxes can be treated equally when using a container with all cells/indices of that box
- brute force search is not implemented but could help if all other strategies fail
- implement more strategies mentioned at https://www.sudokuwiki.org/Sudoku.htm
- which strategies are needed might also depend on the order in which the strategies are executed!
- ideas for code improvement
  - consider using ImmutableList where it is feasible, e.g. in Combinations method
  - use Enumerable more instead of expanded lists
  - use typealiases to make code more readable - is this possible with C#?
  - in InputSolver.RunSolver all puzzles are run through the solver before any output is written
    - consider calling solver and writing output puzzle after puzzle
  - parallel execution when many puzzles are processed
  - perform pruning etc. only based on actually changed cells
  - clean up use of SortedSet vs List
- Grid.Init assumes that the input puzzles always follows the expected syntax -> no error handling otherwise

## Sudoku Puzzles for Testing
- https://projecteuler.info/resources/documents/0096_sudoku.txt
- https://www.sudokuwiki.org/top50000.zip
- https://www.sudokuwiki.org/Just17.zip